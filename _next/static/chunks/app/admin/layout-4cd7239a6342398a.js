(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{8897:function(e,r,t){Promise.resolve().then(t.bind(t,3643))},3643:function(e,r,t){"use strict";t.d(r,{default:function(){return l}});var n=t(7437),o=t(2265),i=t(9376),a=t(6281),s=t(4421);function l(e){let{children:r}=e,{user:t,loading:l}=(0,a.a)(),c=(0,i.useRouter)(),[u,d]=(0,o.useState)(!1),[p,h]=(0,o.useState)(!0),[m,f]=(0,o.useState)("");return((0,o.useEffect)(()=>{(async()=>{if(!l){if(!t){c.push("/");return}if(!t.email&&!t.phoneNumber){d(!1),h(!1);return}try{f(""),console.log("Verifying admin for:",{email:t.email,phone:t.phoneNumber,uid:t.uid});let e=await (0,s.sC)({email:t.email,phoneNumber:t.phoneNumber});console.log("Admin check result:",e),e?d(!0):d(!1)}catch(e){console.error("Admin check failed:",e),f(e.message||"Unknown error occurred"),d(!1)}finally{h(!1)}}})()},[t,l,c]),l||p)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue-900"})}):u?(0,n.jsx)(n.Fragment,{children:r}):(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-2",children:"Access Denied"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"You do not have permission to view this page."}),(0,n.jsxs)("div",{className:"text-sm text-gray-500 mb-6 max-w-md text-center",children:[(0,n.jsx)("p",{className:"font-medium",children:"Logged in as:"}),(0,n.jsxs)("p",{children:["Phone: ",(null==t?void 0:t.phoneNumber)||"N/A"]}),(0,n.jsxs)("p",{children:["Email: ",(null==t?void 0:t.email)||"N/A"]}),(0,n.jsxs)("div",{className:"mt-2 text-xs bg-gray-100 p-2 rounded",children:[(0,n.jsx)("strong",{children:"User UID:"})," ",null==t?void 0:t.uid]}),m&&(0,n.jsxs)("div",{className:"mt-4 p-3 bg-red-50 text-red-700 rounded border border-red-200 text-left text-xs font-mono",children:[(0,n.jsx)("strong",{children:"Debug Error:"}),(0,n.jsx)("br",{}),m]}),(0,n.jsxs)("p",{className:"mt-4 text-xs text-gray-400",children:["Ensure your staff profile exists and its ",(0,n.jsx)("strong",{children:"Document ID"})," matches the UID above to fix permission errors."]})]}),(0,n.jsx)("button",{onClick:()=>c.push("/"),className:"px-4 py-2 bg-brand-blue-900 text-white rounded hover:bg-brand-blue-800 transition-colors",children:"Return Home"})]})}},6281:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return s},a:function(){return l}});var n=t(7437),o=t(2265),i=t(4114);let a=(0,o.createContext)({user:null,loading:!0,isAuthenticated:!1});function s(e){let{children:r}=e,[t,s]=(0,o.useState)(null),[l,c]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let e=(0,i.yv)(e=>{s(e),c(!1)});return()=>e()},[]),(0,n.jsx)(a.Provider,{value:{user:t,loading:l,isAuthenticated:!!t},children:r})}function l(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},4114:function(e,r,t){"use strict";t.d(r,{Ew:function(){return s},OA:function(){return l},qD:function(){return c},w7:function(){return u},yv:function(){return d}});var n=t(3301),o=t(4257),i=t(4421);function a(){let e=o.I8;if(e||(e=(0,o.v0)()),!e)throw Error("Firebase auth is not initialized. Please refresh the page and try again.");return e}function s(){var e,r,t,o,i,s,l;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"recaptcha-container",u=a();if(!u||!u.app)throw Error("Firebase Auth instance is not properly initialized");let d=window.recaptchaVerifier;if(d)try{d&&"function"==typeof d.clear&&(d.clear(),console.log("Cleared existing reCAPTCHA verifier"))}catch(e){(null==e?void 0:e.code)!=="auth/internal-error"&&console.warn("Error clearing existing reCAPTCHA verifier:",e)}finally{delete window.recaptchaVerifier}if(!document.getElementById(c)){let e=document.createElement("div");e.id=c,e.style.display="none",document.body.appendChild(e)}try{console.log("Creating RecaptchaVerifier with auth instance:",{appName:u.app.name,projectId:u.app.options.projectId,apiKey:(null===(e=u.app.options.apiKey)||void 0===e?void 0:e.substring(0,10))+"...",authDomain:u.app.options.authDomain});let r=new n.lI(u,c,{size:"invisible",callback:()=>{console.log("reCAPTCHA verified")},"expired-callback":()=>{console.error("reCAPTCHA expired")}});return window.recaptchaVerifier=r,console.log("RecaptchaVerifier created successfully for app:",u.app.name),r}catch(e){throw console.error("Error creating RecaptchaVerifier:",e),console.error("Auth instance details:",{exists:!!u,appName:null==u?void 0:null===(r=u.app)||void 0===r?void 0:r.name,projectId:null==u?void 0:null===(o=u.app)||void 0===o?void 0:null===(t=o.options)||void 0===t?void 0:t.projectId,apiKey:(null==u?void 0:null===(l=u.app)||void 0===l?void 0:null===(s=l.options)||void 0===s?void 0:null===(i=s.apiKey)||void 0===i?void 0:i.substring(0,10))+"..."}),Error("Failed to initialize reCAPTCHA: ".concat(e.message||"Unknown error"))}}async function l(e,r){var t,o,i,s,l,c;try{let o=a();if(!o||!o.app)throw Error("Firebase Auth is not properly initialized");console.log("\uD83D\uDCE4 Sending OTP with auth instance:",{appName:o.app.name,projectId:o.app.options.projectId,apiKey:(null===(t=o.app.options.apiKey)||void 0===t?void 0:t.substring(0,20))+"...",authDomain:o.app.options.authDomain,storageBucket:o.app.options.storageBucket,phoneNumber:e});let i="AIzaSyC4SqbxwKCJmUBNKt85UwEJgNnep9t7qOY";if(o.app.options.apiKey!==i)throw console.error("❌ API KEY MISMATCH!"),console.error("Expected:",i),console.error("Got:",o.app.options.apiKey),Error("API key mismatch detected. Please clear browser cache and refresh.");console.log("✅ API key verified, proceeding with OTP send...");let s=await (0,n.$g)(o,e,r);return console.log("OTP sent successfully"),s}catch(e){if(console.error("Error sending OTP:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),console.error("Auth instance at error:",{appName:null===(i=a())||void 0===i?void 0:null===(o=i.app)||void 0===o?void 0:o.name,projectId:null===(c=a())||void 0===c?void 0:null===(l=c.app)||void 0===l?void 0:null===(s=l.options)||void 0===s?void 0:s.projectId}),"auth/invalid-app-credential"===e.code)throw Error("Firebase configuration error. Please verify:\n1. API key matches Firebase project\n2. Phone Authentication is enabled\n3. Authorized domains include localhost\n4. Try refreshing the page");if("auth/too-many-requests"===e.code)throw Error("Too many requests. Please wait a moment and try again.");if("auth/invalid-phone-number"===e.code)throw Error("Invalid phone number format. Please enter a valid 10-digit mobile number.");if("auth/quota-exceeded"===e.code)throw Error("SMS quota exceeded. Please try again later.");throw Error(e.message||"Failed to send OTP. Please try again.")}}async function c(e,r){try{let t=(await e.confirm(r)).user;return t.phoneNumber&&await (0,i.XB)(t.uid,{id:t.uid,phone:t.phoneNumber}),t}catch(e){throw console.error("Error verifying OTP:",e),Error(e.message||"Invalid OTP code")}}async function u(){try{let e=a();await (0,n.w7)(e)}catch(e){throw console.error("Error signing out:",e),Error(e.message||"Failed to sign out")}}function d(e){try{let r=a();return(0,n.Aj)(r,e)}catch(e){return()=>{}}}},9376:function(e,r,t){"use strict";var n=t(5475);t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(r,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[358,139,943,421,971,117,744],function(){return e(e.s=8897)}),_N_E=e.O()}]);