"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{4257:function(e,t,o){let a,n,r;o.d(t,{I8:function(){return f},db:function(){return h},getApp:function(){return g},v0:function(){return m}});var i=o(738),c=o(5978),s=o(3301),l=o(257);let u={apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY||"AIzaSyC4SqbxwKCJmUBNKt85UwEJgNnep9t7qOY",authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"worthyten-otp-a925d.firebaseapp.com",projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"worthyten-otp-a925d",storageBucket:l.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"worthyten-otp-a925d.firebasestorage.app",messagingSenderId:l.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"1067702314639",appId:l.env.NEXT_PUBLIC_FIREBASE_APP_ID||"1:1067702314639:web:0bb2a39181720c306572fa",measurementId:l.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||"G-WBXQ5SM16Y"};{let e=["apiKey","authDomain","projectId","appId"].filter(e=>!u[e]);e.length>0?console.warn("Missing Firebase config fields:",e):console.log("Firebase config loaded:",{projectId:u.projectId,authDomain:u.authDomain,hasApiKey:!!u.apiKey})}function d(){var e,t,o,a,n,c;try{let c=(0,i.C6)();if(0===c.length){console.log("\uD83D\uDD35 Initializing Firebase app with config:",{projectId:u.projectId,authDomain:u.authDomain,storageBucket:u.storageBucket,apiKey:(null===(t=u.apiKey)||void 0===t?void 0:t.substring(0,15))+"...",appId:u.appId}),r=(0,i.ZF)(u),console.log("✅ Firebase app initialized successfully:",{name:r.name,options:{projectId:r.options.projectId,authDomain:r.options.authDomain,storageBucket:r.options.storageBucket,apiKey:(null===(o=r.options.apiKey)||void 0===o?void 0:o.substring(0,15))+"...",appId:r.options.appId}});let e=[];return r.options.projectId!==u.projectId&&e.push("projectId: expected ".concat(u.projectId,", got ").concat(r.options.projectId)),r.options.authDomain!==u.authDomain&&e.push("authDomain: expected ".concat(u.authDomain,", got ").concat(r.options.authDomain)),r.options.storageBucket!==u.storageBucket&&e.push("storageBucket: expected ".concat(u.storageBucket,", got ").concat(r.options.storageBucket)),r.options.apiKey!==u.apiKey&&e.push("apiKey: mismatch"),e.length>0?console.error("❌ Firebase config mismatches detected:",e):console.log("✅ All Firebase config values match"),r}return r=c[0],console.log("\uD83D\uDD04 Using existing Firebase app:",{name:r.name,options:{projectId:r.options.projectId,authDomain:r.options.authDomain,storageBucket:r.options.storageBucket,apiKey:(null===(e=r.options.apiKey)||void 0===e?void 0:e.substring(0,15))+"..."}}),r.options.projectId===u.projectId&&r.options.apiKey===u.apiKey&&r.options.authDomain===u.authDomain&&r.options.storageBucket===u.storageBucket||(console.error("❌ CRITICAL: Existing Firebase app does NOT match current config!"),console.error("Expected config:",{projectId:u.projectId,apiKey:(null===(a=u.apiKey)||void 0===a?void 0:a.substring(0,15))+"...",authDomain:u.authDomain,storageBucket:u.storageBucket}),console.error("Actual app config:",{projectId:r.options.projectId,apiKey:(null===(n=r.options.apiKey)||void 0===n?void 0:n.substring(0,15))+"...",authDomain:r.options.authDomain,storageBucket:r.options.storageBucket}),console.error("⚠️ This will cause auth errors! Please:"),console.error("1. Clear browser cache completely"),console.error("2. Hard refresh (Ctrl+Shift+R)"),console.error("3. Or restart the dev server")),r}catch(e){console.error("❌ Error initializing Firebase:",e),console.error("Firebase config being used:",{projectId:u.projectId,authDomain:u.authDomain,storageBucket:u.storageBucket,apiKey:(null===(c=u.apiKey)||void 0===c?void 0:c.substring(0,15))+"...",appId:u.appId});return}}function p(){let e=d();if(e)return(0,s.v0)(e)}function g(){return d()}function m(){return p()}d(),a=function(){let e=d();if(e)return(0,c.ad)(e)}(),n=p();let h=a,f=n},4421:function(e,t,o){o.d(t,{Dg:function(){return p},PW:function(){return c},XB:function(){return d},_v:function(){return u},gk:function(){return l},l$:function(){return i},nM:function(){return g},sC:function(){return m},zR:function(){return s}});var a=o(5978),n=o(4257);function r(){if(!n.db)throw Error("Firestore is not initialized. This function must be called on the client side.");return n.db}async function i(e){let t=(0,a.hJ)(r(),"valuations"),o={...e,createdAt:a.EK.now(),updatedAt:a.EK.now()};return(await (0,a.ET)(t,o)).id}async function c(e,t){let o,n;let i=(0,a.hJ)(r(),"devices"),c=e.toLowerCase().trim(),s=c;c.includes("phone")||c.includes("iphone")?s="Phone":c.includes("laptop")?s="Laptop":c.includes("tablet")||c.includes("ipad")?s="iPad":c.includes("camera")&&(s="DSLR");try{if(o=t?(0,a.IO)(i,(0,a.ar)("category","==",s),(0,a.ar)("brand","==",t.trim())):(0,a.IO)(i,(0,a.ar)("category","==",s)),(n=await (0,a.PL)(o)).empty){let e=s;c.includes("camera")?e="DSLR"===s?"Lens":"Lens"===s?"Camera":"DSLR":c.includes("phone")?e="phone":c.includes("laptop")?e="laptop":(c.includes("tablet")||c.includes("ipad"))&&(e="ipad"),o=t?(0,a.IO)(i,(0,a.ar)("category","==",e),(0,a.ar)("brand","==",t.trim())):(0,a.IO)(i,(0,a.ar)("category","==",e)),n=await (0,a.PL)(o)}}catch(e){return console.error("Error querying devices:",e),[]}return n.docs.map(e=>({id:e.id,...e.data()}))}async function s(e,t){let o;let n=(0,a.hJ)(r(),"products"),i=e.toLowerCase().trim(),c=[];c=i.includes("phone")||i.includes("iphone")?["Phone","phone","phones","Phones"]:i.includes("laptop")?["Laptop","laptop","laptops","Laptops"]:i.includes("tablet")||i.includes("ipad")?["iPad","ipad","Tablet","tablet","tablets","Tablets"]:i.includes("camera")?["DSLR","dslr","Dslr","Camera","camera","cameras","Cameras"]:[i,i.charAt(0).toUpperCase()+i.slice(1)];let s=t.trim(),l=(0,a.IO)(n,(0,a.ar)("brand","==",s),(0,a.ar)("category","==",c[0]));try{if((o=await (0,a.PL)(l)).empty&&c.length>1)for(let e=1;e<c.length;e++){let t=(0,a.IO)(n,(0,a.ar)("brand","==",s),(0,a.ar)("category","==",c[e])),r=await (0,a.PL)(t);if(!r.empty){o=r;break}}if(o.empty){console.log("No products found for category variations ".concat(c.join(", "),' and brand "').concat(s,'". Trying brand-only query...'));let e=(0,a.IO)(n,(0,a.ar)("brand","==",s)),t=await (0,a.PL)(e);t.empty||(console.log("Found ".concat(t.docs.length,' products for brand "').concat(s,'" with categories:'),[...new Set(t.docs.map(e=>e.data().category))]),o=t)}}catch(t){console.error("Firestore query error:",t);let e=(0,a.IO)(n,(0,a.ar)("brand","==",s));o=await (0,a.PL)(e)}let u=o.docs.map(e=>{var t,o,a,n,r,i,c;let s=e.data(),l=null!==(a=null!==(o=null!==(t=s.modelName)&&void 0!==t?t:s["Model Name"])&&void 0!==o?o:s.name)&&void 0!==a?a:"",u=null!==(i=null!==(r=null!==(n=s.basePrice)&&void 0!==n?n:s.price)&&void 0!==r?r:s["Price (₹)"])&&void 0!==i?i:0,d=null!==(c=s.imageUrl)&&void 0!==c?c:s.image;return{id:e.id,brand:s.brand,category:s.category,modelName:l,basePrice:u,imageUrl:d}}),d=u.filter(e=>{var t,o;let a=(null===(t=e.category)||void 0===t?void 0:t.trim())||"",n=(null===(o=e.brand)||void 0===o?void 0:o.trim())||"",r=!1,c=a.toLowerCase();r=i.includes("phone")||i.includes("iphone")?c.includes("phone")||c.includes("iphone"):i.includes("laptop")?c.includes("laptop"):i.includes("tablet")||i.includes("ipad")?c.includes("tablet")||c.includes("ipad"):i.includes("camera")?(c.includes("camera")||a.toLowerCase().includes("camera")||"camera"===a.toLowerCase()||"cameras"===a.toLowerCase()||"dslr"===c||"DSLR"===a||"dslr"===a)&&"lens"!==c&&"Lens"!==a&&"lens"!==a:c===i||c.includes(i)||i.includes(c)||a.toLowerCase()===i;let l=n.toLowerCase()===s.toLowerCase();return r&&l});if(0===d.length&&u.length>0){let t=[...new Set(u.map(e=>e.category))];if(console.warn("No products found after filtering. Found ".concat(u.length,' products for brand "').concat(s,'". Categories:'),t),console.log('Looking for category: "'.concat(i,'" (normalized from "').concat(e,'")')),console.log("Tried category variations:",c),i.includes("camera")){let e=u.filter(e=>{let t=(e.category||"").toLowerCase(),o=(e.brand||"").toLowerCase();return(t.includes("camera")||"dslr"===t||"DSLR"===e.category)&&"lens"!==t&&"Lens"!==e.category&&"lens"!==e.category&&o===s.toLowerCase()});if(e.length>0)return console.log("Using lenient camera filter: found ".concat(e.length," products (excluding lenses)")),e}}return d}async function l(e){var t,o,n,i,c,s,l,u;let d=(0,a.JU)(r(),"products",e),p=await (0,a.QT)(d);if(!p.exists())return null;let g=p.data(),m=null!==(n=null!==(o=null!==(t=g.modelName)&&void 0!==t?t:g["Model Name"])&&void 0!==o?o:g.name)&&void 0!==n?n:"",h=null!==(s=null!==(c=null!==(i=g.basePrice)&&void 0!==i?i:g.price)&&void 0!==c?c:g["Price (₹)"])&&void 0!==s?s:0,f=null!==(l=g.internalBasePrice)&&void 0!==l?l:.5*h,y=null!==(u=g.imageUrl)&&void 0!==u?u:g.image;return{id:p.id,brand:g.brand,category:g.category,modelName:m,basePrice:h,internalBasePrice:f,imageUrl:y}}async function u(e,t){let o=(0,a.hJ)(r(),"devices"),n=(0,a.IO)(o,(0,a.ar)("brand","==",e.toLowerCase()),(0,a.ar)("model","==",t)),i=await (0,a.PL)(n);if(!i.empty){let e=i.docs[0];return{id:e.id,...e.data()}}return null}async function d(e,t){let o=(0,a.JU)(r(),"users",e);(await (0,a.QT)(o)).exists()?await (0,a.r7)(o,t):await (0,a.pl)(o,{id:e,...t,createdAt:a.EK.now()})}async function p(){let e=(0,a.hJ)(r(),"products");return(await (0,a.PL)(e)).docs.map(e=>{var t,o,a,n,r,i,c,s;let l=e.data(),u=null!==(a=null!==(o=null!==(t=l.modelName)&&void 0!==t?t:l["Model Name"])&&void 0!==o?o:l.name)&&void 0!==a?a:"",d=null!==(i=null!==(r=null!==(n=l.basePrice)&&void 0!==n?n:l.price)&&void 0!==r?r:l["Price (₹)"])&&void 0!==i?i:0,p=null!==(c=l.internalBasePrice)&&void 0!==c?c:.5*d,g=null!==(s=l.imageUrl)&&void 0!==s?s:l.image;return{id:e.id,brand:l.brand,category:l.category,modelName:u,basePrice:d,internalBasePrice:p,imageUrl:g}})}async function g(e,t){let o=(0,a.JU)(r(),"products",e);await (0,a.r7)(o,t)}async function m(e){try{let t=(0,a.hJ)(r(),"staffUsers");if(e.email){let o=(0,a.IO)(t,(0,a.ar)("email","==",e.email)),n=await (0,a.PL)(o);if(!n.empty){let e=n.docs[0].data();if("superadmin"===e.role&&!0===e.isActive)return!0}}if(e.phoneNumber){let o=(0,a.IO)(t,(0,a.ar)("phoneNumber","==",e.phoneNumber)),n=await (0,a.PL)(o);if(!n.empty){let e=n.docs[0].data();if("superadmin"===e.role&&!0===e.isActive)return!0}}return!1}catch(e){throw console.error("Error checking super admin status:",e),e}}}}]);